--- STEAMODDED HEADER
--- MOD_NAME: Moldge Pack
--- MOD_ID: MoldgePack
--- MOD_AUTHOR: [kazaxc]
--- MOD_DESCRIPTION: The moldge pack for Balatrothon.
--- PREFIX: mldg
----------------------------------------------
------------MOD CODE -------------------------

SMODS.Atlas{ -- Combined jokers atlas
    key = 'Jokers', -- atlas key
    path = 'Jokers.png', -- path to the image
    px = 71, -- width of one card
    py = 95 -- height of one card
}

SMODS.Atlas{ -- Nice Joker
    key = 'Joker2', -- atlas key
    path = 'Joker2.png', -- path to the image
    px = 138, -- width of one card
    py = 186 -- height of one card
}

SMODS.Atlas{ -- Enhancement atlas
    key = 'Enhancers', -- atlas key
    path = 'Enhancers.png', -- path to the image
    px = 71, -- width of one card
    py = 95 -- height of one cards
}

SMODS.Atlas{ -- Moldge Card
    key = 'MoldgeMaster', -- atlas key
    path = 'MoldgeMaster.png', -- path to the image
    px = 209, -- width of one card
    py = 281 -- height of one cards
}

SMODS.Atlas{ -- Back of house
    key = 'BackHouse', -- atlas key
    path = 'BackHouse.png', -- path to the image
    px = 140, -- width of one card
    py = 188 -- height of one cards
}

SMODS.Atlas{
    key = 'ExtraShort', -- atlas key
    path = 'ExtraShortJoker.png', -- path to the image
    px = 138, -- width of one card
    py = 138 -- height of one cards
}

SMODS.Atlas{
    key = 'dennis', -- atlas key
    path = 'dennis.png', -- path to the image
    px = 140, -- width of one card
    py = 188 -- height of one cards
}

SMODS.Atlas{
    key = 'Appulrelia', -- atlas key
    path = 'Appulrelia.png', -- path to the image
    px = 140, -- width of one card
    py = 188 -- height of one cards
}

SMODS.Atlas{
    key = 'kiss', -- atlas key
    path = 'kiss.png', -- path to the image
    px = 140, -- width of one card
    py = 188 -- height of one cards
}

SMODS.Atlas{
    key = 'MovieNight', -- atlas key
    path = 'MovieNight.png', -- path to the image
    px = 140, -- width of one card
    py = 188 -- height of one cards
}

SMODS.Atlas{
    key = 'RainJoker', -- atlas key
    path = 'RainJoker.png', -- path to the image
    px = 71, -- width of one card
    py = 95 -- height of one cards
}

SMODS.Atlas{
    key = 'ving', -- atlas key
    path = 'ving.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'ethan', -- atlas key
    path = 'ethan.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'ben', -- atlas key
    path = 'ben.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'eepy', -- atlas key
    path = 'eepy.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'euroTruck', -- atlas key
    path = 'eurotruck.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'badger', -- atlas key
    path = 'Badger.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'creation', -- atlas key
    path = 'Creation.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'sucker', -- atlas key
    path = 'Sucker.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'gulper', -- atlas key
    path = 'Gulper.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'ricksCrayon', -- atlas key
    path = 'RicksCrayon.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'ricksCrayonStash', -- atlas key
    path = 'RicksCrayonStash.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'hotTake', -- atlas key
    path = 'hotTake.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'fox', -- atlas key
    path = 'fox.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'nolem', -- atlas key
    path = 'Nolem.png', -- path to the image
    px = 73,
    py = 97
}

SMODS.Atlas{
    key = 'fishbreakfast', -- atlas key
    path = 'fishebreakfast.png', -- path to the image
    px = 73,
    py = 97
}

SMODS.Atlas{
    key = 'hypeTrain', -- atlas key
    path = 'Hype_Train.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'left_arm', -- atlas key
    path = 'left_arm.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'dennis_body', -- atlas key
    path = 'dennis_the_forbidden_one.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'right_arm', -- atlas key
    path = 'dennis-hand-of-x.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'left_leg', -- atlas key
    path = 'dennisleftleg.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Atlas{
    key = 'right_leg', -- atlas key
    path = 'right_leg.png', -- path to the image
    px = 71,
    py = 95
}

SMODS.Sound{
    key = 'hiMark', -- sound key
    path = 'hi.ogg' -- path to the sound
}

SMODS.Sound{
    key = 'glassBreak', -- sound key
    path = 'glass.ogg' -- path to the sound
}

SMODS.Sound{
    key = 'choo-choo', -- sound key
    path = 'choo-choo.ogg' -- path to the sound
}

SMODS.Joker{
    key = 'appulrelia', -- joker key
    loc_txt = { -- local text
        name = 'A is for Apple',
        text = {
            'This card gains {C:chips}+#2#{} Chips',
            'for each scored {C:attention}Ace{}',
            '{C:inactive}(Currently {C:chips}+#1#{C:inactive} Chips)'
        }
    },
    config = { extra = { chips = 0, chip_gain = 5 } },
    rarity = 1,
    atlas = 'Appulrelia',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 6,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.chips, card.ability.extra.chip_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                chip_mod = card.ability.extra.chips,
                message = localize { type = 'variable', key = 'a_chips', vars = { card.ability.extra.chips } }
            }
        end
        if context.individual and context.cardarea == G.play and context.other_card:get_id() == 14 then
            card.ability.extra.chips = card.ability.extra.chips + card.ability.extra.chip_gain
            return {
                message = 'A is for Apple!',
                colour = G.C.CHIPS,
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'MovieNight', -- joker key
    loc_txt = { -- local text
        name = 'What Time is Movie Night?',
        text = {
            'Gains {X:mult,C:white} X#2# {} Mult',
            'for each scored {C:attention}7{} and {C:attention}9{}',
            '{C:inactive}(Currently {X:mult,C:white} X#1# {C:inactive} Mult)'
        }
    },
    config = { extra = { Xmult = 1, Xmult_gain = 0.1 } },
    rarity = 1,
    atlas = 'MovieNight',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 8,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult, card.ability.extra.Xmult_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                Xmult_mod = card.ability.extra.Xmult,
                message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } }
            }
        end
        if context.individual and context.cardarea == G.play and not context.blueprint then
            if context.other_card:get_id() == 7 or context.other_card:get_id() == 9 then
                card.ability.extra.Xmult = card.ability.extra.Xmult + card.ability.extra.Xmult_gain
                return {
                    message = 'What Time?!',
                    colour = G.C.MULT,
                    card = card
                }
            end
        end
    end
}

SMODS.Joker{
    key = 'berry', -- joker key
    loc_txt = { -- local text
        name = 'Berry Club',
        text = {
            '{C:green}#2# in #3#{} chance this',
            'card provides',
            '{X:mult,C:white} X#1# {} Mult',
        }
    },
    config = { extra = { Xmult = 3, odds = 2 } },
    rarity = 3,
    atlas = 'Jokers',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 5,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult, (G.GAME.probabilities.normal or 1), card.ability.extra.odds } }
    end,
    calculate = function (self, card, context)        
        if context.joker_main then
            if pseudorandom('melon_land_chatter') > G.GAME.probabilities.normal / card.ability.extra.odds then
                return { message = 'Gift Subs!' }
            else
                return {
                    message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } },
                    Xmult_mod = card.ability.extra.Xmult
                  }
            end
        end
    end
}

SMODS.Joker{
    key = 'kiss', -- joker key
    loc_txt = { -- local text
        name = 'Pair of Fools',
        text = {
            "Gains {C:mult}+#2#{} Mult",
            "if played hand",
            "contains a {C:attention}Pair{} and {C:mult}Heart{}",
            "{C:inactive}(Currently {C:mult}+#1#{C:inactive} Mult)"
        }
    },
    config = { extra = { mult = 0, mult_gain = 2 } },
    pos = { x = 0, y = 0 },
    cost = 6,
    rarity = 1,
    atlas = 'kiss',
    unlocked = true,
    discovered = true,
    blueprint_compat = false,
    allow_duplicates = false,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.mult, card.ability.extra.mult_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                mult_mod = card.ability.extra.mult,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.mult } }
            }
        end

        if context.before and next(context.poker_hands['Pair']) and not context.blueprint then
            local hearts = 0
            for i = 1, #context.scoring_hand do
                if context.scoring_hand[i]:is_suit('Hearts') then hearts = hearts + 1 end
            end

            if hearts > 0 then
                card.ability.extra.mult = card.ability.extra.mult + card.ability.extra.mult_gain
                return {
                    message = 'MWAH!',
                    colour = G.C.MULT,
                    card = card
                }
            end
        end
    end
}

SMODS.Joker{
    key = 'niceJoker', -- joker key
    loc_txt = { -- local text
        name = 'Nice Cock',
        text = {
            'Each played {C:attention}King{}',
            'gives {C:chips}+#1#{} Chips when scored'
        }
    },
    config = { extra = { chips = 69 } },
    rarity = 1,
    atlas = 'Joker2',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 5,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = {card.ability.extra.chips} }
    end,
    calculate = function (self, card, context)
        if context.individual and context.cardarea == G.play then
            -- :get_id tests for the rank of the card. Other than 2-10, Jack is 11, Queen is 12, King is 13, and Ace is 14.
            if context.other_card:get_id() == 13 then
              -- Specifically returning to context.other_card is fine with multiple values in a single return value, chips/mult are different from chip_mod and mult_mod, and automatically come with a message which plays in order of return.
              return {
                message = 'Nice Cock!',
                chips = card.ability.extra.chips,
                card = context.other_card
              }
            end
          end
    end
}

SMODS.Joker{
    key = 'BackHouse',
    loc_txt = {
        name = 'Back of House',
        text = {
            "Gains {C:mult}+#2#{} Mult",
            "if played hand",
            "contains a {C:attention}Full House{}",
            "{C:inactive}(Currently {C:mult}+#1#{C:inactive} Mult)"
        }
    },
    config = { extra = { mult = 0, mult_gain = 2} },
    pos = { x = 0, y = 0},
    cost = 8,
    rarity = 1,
    atlas = 'BackHouse',
    unlocked = true,
    discovered = true,
    blueprint_compat = false,
    allow_duplicates = false,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.mult, card.ability.extra.mult_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                mult_mod = card.ability.extra.mult,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.mult } }
            }
        end

        if context.before and next(context.poker_hands['Full House']) and not context.blueprint then
            card.ability.extra.mult = card.ability.extra.mult + card.ability.extra.mult_gain
            return {
                message = 'Banned!',
                colour = G.C.MULT,
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'ShortJoker', -- joker key
    loc_txt = { -- local text
        name = 'The Jortster',
        text = {
            'Gains {C:chips}+#2#{} Chips',
            'if played hand has',
            ' exactly {C:attention}2{} cards',
            '{C:inactive}(Currently {C:chips}+#1#{C:inactive} Chips)',
        }
    },
    config = { extra = { chips = 0, chip_gain = 8 } },
    pos = { x = 0, y = 0 },
    cost = 4,
    rarity = 1,
    atlas = 'ExtraShort',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.chips, card.ability.extra.chip_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                chip_mod = card.ability.extra.chips,
                message = localize { type = 'variable', key = 'a_chips', vars = { card.ability.extra.chips } }
            }
        end
        if context.before and #context.full_hand == 2 and not context.blueprint then
            card.ability.extra.chips = card.ability.extra.chips + card.ability.extra.chip_gain
            return {
                message = 'Jorts!',
                colour = G.C.CHIPS,
                card = card
            }
        end
    end,
    set_ability = function (self, card, initial, delay_sprites)
        if self.discovered or card.bypass_discovery_center then
            card.T.h = card.T.w * 0.5
            --card.children.floating_sprite.T.h = card.children.floating_sprite.T.w
        end
    end,
    set_sprites = function (self, card, front)
        if self.discovered or card.bypass_discovery_center then
            card.children.center.scale.y = card.children.center.scale.x
            --card.children.floating_sprite.scale.y = card.children.floating_sprite.scale.x
        end
    end,
    load = function (self, card, card_table, other_card)
        if self.discovered or card.bypass_discovery_center then
            card.T.h = card.T.w * 0.75
            --card.children.floating_sprite.T.h = card.children.floating_sprite.T.w
        end 
    end
}

SMODS.Joker{
    key = 'EuroTruck', -- joker key
    loc_txt = { -- local text
        name = 'Euro Truck Simulator',
        text = {
            'Adds {C:attention}Double{} the diffenence',
            'in rank between the',
            '{C:attention}Highest{} scoring card',
            'and {C:attention}Lowest{} card',
            'held in hand to Mult'
        }
    },
    config = { extra = { mult = 0 } },
    rarity = 1,
    atlas = 'euroTruck',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 6,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.mult } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            local lowest = 14
            local highest = 0

            for i = 1, #context.scoring_hand do
                local cardScore = context.scoring_hand[i]:get_id()
                if cardScore > highest then highest = cardScore end
            end

            for i = 1, #G.hand.cards do
                local cardScore = G.hand.cards[i]:get_id()
                if cardScore < lowest then lowest = cardScore end
            end

            card.ability.extra.mult = ((highest - lowest) * 2)

            return {
                mult_mod = card.ability.extra.mult,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.mult } },
                sound = 'mldg_glassBreak',
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'moldgeMaster', -- joker key
    loc_txt = { -- local text
        name = 'Master of the Moldge',
        text = {
            'All played cards',
            'become {C:attention}Moldge{} cards',
            'when scored'
        }
    },
    config = { extra = {} },
    rarity = 1,
    atlas = 'MoldgeMaster',
    unlocked = true,
    discovered = true,
    blueprint_compat = false,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 6,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = {} }
    end,
    calculate = function (self, card, context)
        if context.individual and context.cardarea == G.play and not context.blueprint then
            for _,v in ipairs(context.scoring_hand) do
                v:set_ability(G.P_CENTERS['m_mldg_moldge'])
            end
            return {
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'dennis', -- joker key
    loc_txt = { -- local text
        name = 'Dennis',
        text = {
            'Played {C:attention}Moldge{} cards',
            'give {C:mult}+#1#{} Mult when scored'
        }
    },
    config = { extra = { mult = 8, focus = card } },
    rarity = 1,
    atlas = 'dennis',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 4,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.mult } }
    end,
    calculate = function (self, card, context)
        if context.individual and context.other_card.ability.name == 'm_mldg_moldge' and context.cardarea == G.play then
            return {
                mult_mod = card.ability.extra.mult,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.mult } },
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'RainJoker', -- joker key
    loc_txt = { -- local text
        name = 'Make it Rain',
        text = {
            'Earn {C:money}$#1#{} for each',
            'played {C:attention}Moldge{} card',
        }
    },
    config = { extra = { money = 5, focus = card } },
    rarity = 1,
    atlas = 'RainJoker',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.money } }
    end,
    calculate = function (self, card, context)
        if context.individual and context.other_card.ability.name == 'm_mldg_moldge' and context.cardarea == G.play then
            return {
                dollars = card.ability.extra.money,
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'vingJoker', -- joker key
    loc_txt = { -- local text
        name = 'Ving Rhames',
        text = {
            'Debuffed at start of blind until',
            '{C:attention}Tom Cruise{} joker is owned',
            'Gains {X:mult,C:white} X Mult {} equal to',
            'heighest scored card divided by 10',
            '{C:inactive}(Currently {X:mult,C:white} X#1# {C:inactive} Mult)'
        }
    },
    config = { extra = { Xmult = 1 } },
    rarity = 3,
    atlas = 'ving',
    unlocked = true,
    discovered = false,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult } }
    end,
    calculate = function (self, card, context)

        if context.setting_blind then
            if next(SMODS.find_card('j_mldg_ethan')) then
                card:set_debuff(false)
            else
                card:set_debuff(true)
            end
        end

        if context.joker_main then
            return {
                Xmult_mod = card.ability.extra.Xmult,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.Xmult } }
            }
        end

        if context.before and not context.blueprint then
            local heighest = 0.0
            for i = 1, #context.scoring_hand do
                local cardScore = context.scoring_hand[i]:get_id() / 10
                if cardScore > heighest then heighest = cardScore end
            end
            card.ability.extra.Xmult = card.ability.extra.Xmult + heighest
            return {
                message = 'Ethan???',
                colour = G.C.MULT,
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'ethan', -- joker key
    loc_txt = { -- local text
        name = 'Tom Cruise',
        text = {
            'Earn {C:money}$#1#{} at',
            'end of round',
            'Helps his friends :)'
        }
    },
    config = { extra = { money = 10 } },
    rarity = 1,
    atlas = 'ethan',
    unlocked = true,
    discovered = false,
    blueprint_compat = false,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 12,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.money } }
    end,
    calc_dollar_bonus = function(self, card)
        local bonus = card.ability.extra.money
        if bonus > 0 then return bonus end
    end
}

SMODS.Joker{
    key = 'ben10', -- joker key
    loc_txt = { -- local text
        name = 'Ben 10',
        text = {
            "{X:mult,C:white} X#1# {} Mult",
            "{C:green}#2# in #3#{} chance this",
            "card is destroyed",
            "at end of round"
        }
    },
    config = { extra = { Xmult = 10, odds = 10 } },
    rarity = 3,
    atlas = 'ben',
    unlocked = true,
    discovered = false,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult, (G.GAME.probabilities.normal or 1), card.ability.extra.odds } }
    end,
    calculate = function(self, card, context)
        if context.joker_main then
          return {
            message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } },
            Xmult_mod = card.ability.extra.Xmult
          }
        end

        if context.end_of_round and context.game_over == false and not context.repetition and not context.blueprint then
          if pseudorandom('ben10') < G.GAME.probabilities.normal / card.ability.extra.odds then
            G.E_MANAGER:add_event(Event({
              func = function()
                play_sound('tarot1')
                card.T.r = -0.2
                card:juice_up(0.3, 0.4)
                card.states.drag.is = true
                card.children.center.pinch.x = true
                G.E_MANAGER:add_event(Event({
                  trigger = 'after',
                  delay = 0.3,
                  blockable = false,
                  func = function()
                    G.jokers:remove_card(card)
                    card:remove()
                    card = nil
                    return true;
                  end
                }))
                return true
              end
            }))
            return {
              message = 'NO MY MENTAL!'
            }
          else
            return {
              message = 'Its Hero Time!'
            }
          end
        end
    end
}

SMODS.Joker{
    key = 'eepy', -- joker key
    loc_txt = { -- local text
        name = 'Gods Eepiest Solider',
        text = {
            "Creates a {C:purple}Tarot{} card",
            "if played hand",
            "contains a {C:attention}Full House{}",
            "and a {C:attention}Face{} card"
        }
    },
    config = { extra = {} },
    rarity = 1,
    atlas = 'eepy',
    unlocked = true,
    discovered = true,
    blueprint_compat = false,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 4,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = {} }
    end,
    calculate = function (self, card, context)
        if context.before and next(context.poker_hands['Full House']) then
            local face = false
            for i = 1, #context.scoring_hand do
                if context.scoring_hand[i]:is_face() then face = true end
            end
            if face and not (context.blueprint_card or self).getting_sliced and #G.consumeables.cards + G.GAME.consumeable_buffer < G.consumeables.config.card_limit then
                local new_card = create_card('Tarot',G.consumeables, nil, nil, nil, nil, nil, 'car')
                new_card:add_to_deck()
                G.consumeables:emplace(new_card)
                return {
                    message = 'HONK SHOO!',
                    sound = 'mldg_glassBreak'
                }
            end
        end
    end
}

SMODS.Joker{
    key = 'badgerArtist', -- joker key
    loc_txt = { -- local text
        name = 'The Artist',
        text = {
            '{C:green}#1# in #2#{} chance',
            'scored cards',
            'become {C:attention}Wild{}'
        }
    },
    config = { extra = { odds = 2, focus = card } },
    rarity = 1,
    atlas = 'badger',
    unlocked = true,
    discovered = true,
    blueprint_compat = false,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 5,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { (G.GAME.probabilities.normal or 1), card.ability.extra.odds } }
    end,
    calculate = function (self, card, context)
        if context.individual and context.cardarea == G.play and not context.blueprint then
            for _,v in ipairs(context.scoring_hand) do
                if pseudorandom('badgerArtist') > G.GAME.probabilities.normal / card.ability.extra.odds then
                    v:set_ability(G.P_CENTERS['m_wild'])
                end
            end
            return {
                card = card
            }
        end
    end
}

SMODS.Consumable{
    key = 'creation', -- consumeable key
    set = 'Tarot', -- consumable set
    loc_txt = { -- local text
        name = 'Creation',
        text = {
            'Convert up to {C:attention}#1#{} selected cards',
            'to {C:attention}Moldge{} cards'
        }
    },
    config = { extra = { cards = 2 } },
    atlas = 'creation',
    pos = { x = 0, y = 0 },
    cost = 3,
    unlocked = true,
    discovered = true,
    loc_vars = function(self,info_queue, center)
        return {vars = {center.ability.extra.cards}}
    end,
    can_use = function(self,card)
        if G and G.hand then
            if #G.hand.highlighted ~= 0 and #G.hand.highlighted <= card.ability.extra.cards then
                return true
            end
        end
        return false
    end,
    use = function(self,card,area,copier)
        for i = 1, #G.hand.highlighted do
            G.hand.highlighted[i]:set_ability(G.P_CENTERS['m_mldg_moldge'])
        end
    end
}

SMODS.Joker{
    key = 'sucker', -- joker key
    loc_txt = { -- local text
        name = 'Sucker',
        text = {
            'If {C:attention}first discard{} of round',
            'has only {C:attention}1{} card, destroy',
            'it and this card gains {X:mult,C:white} X #2# {} Mult',
            '{C:inactive}(Currently {X:mult,C:white} X #1# {C:inactive} Mult)'
        }
    },
    config = { extra = { Xmult = 1, Xmult_gain = 0.1, focus = card } },
    rarity = 1,
    atlas = 'sucker',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 5,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult, card.ability.extra.Xmult_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                Xmult_mod = card.ability.extra.Xmult,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.Xmult } }
            }
        end
        if context.discard and #context.full_hand == 1 and G.GAME.current_round.discards_used == 0 and not context.blueprint then
            card.ability.extra.Xmult = card.ability.extra.Xmult + card.ability.extra.Xmult_gain
            return {
                message = 'SLURP!',
                colour = G.C.MULT,
                remove = true,
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'gulper', -- joker key
    loc_txt = { -- local text
        name = 'Gulper',
        text = {
            'If {C:attention}first discard{} of round',
            'has only {C:attention}1{} card, destroy',
            'it and this card gains Chips equal to',
            'the value of the destroyed card',
            '{C:inactive}(Currently {C:chips}+#1#{C:inactive} Chips)'
        }
    },
    config = { extra = { chips = 1, focus = card } },
    rarity = 1,
    atlas = 'gulper',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 6,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.chips } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                message = localize { type = 'variable', key = 'a_chips', vars = { card.ability.extra.chips } },
                chip_mod = card.ability.extra.chips
            }
        end
        if context.discard and #context.full_hand == 1 and G.GAME.current_round.discards_used == 0 and not context.blueprint then
            card.ability.extra.chips = card.ability.extra.chips + context.full_hand[1]:get_id()
            return {
                message = 'GULP!',
                colour = G.C.CHIPS,
                remove = true,
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'ricksCrayon', -- joker key
    loc_txt = {
        name = 'Rick\'s Crayon',
        text = {
          "{C:mult}+#1#{} Mult",
          "{C:green}#2# in #3#{} chance this",
          "card is destroyed",
          "at end of round"
        }
      },
      -- This searches G.GAME.pool_flags to see if Gros Michel went extinct. If so, no longer shows up in the shop.
      no_pool_flag = 'ricksCrayon_extinct',
      config = { extra = { mult = 25, odds = 6 } },
      rarity = 1,
      atlas = 'ricksCrayon',
      pos = { x = 0, y = 0 },
      cost = 5,
      -- Gros Michel is incompatible with the eternal sticker, so this makes sure it can't be eternal.
      unlocked = true,
      discovered = true,
      eternal_compat = false,
      loc_vars = function(self, info_queue, card)
        return { vars = { card.ability.extra.mult, (G.GAME.probabilities.normal or 1), card.ability.extra.odds } }
      end,
      calculate = function(self, card, context)
        if context.joker_main then
          return {
            mult_mod = card.ability.extra.mult,
            message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.mult } }
          }
        end
    
        -- Checks to see if it's end of round, and if context.game_over is false.
        -- Also, not context.repetition ensures it doesn't get called during repetitions.
        if context.end_of_round and not context.repetition and context.game_over == false and not context.blueprint then
          -- Another pseudorandom thing, randomly generates a decimal between 0 and 1, so effectively a random percentage.
          if pseudorandom('gros_michel2') < G.GAME.probabilities.normal / card.ability.extra.odds then
            -- This part plays the animation.
            G.E_MANAGER:add_event(Event({
              func = function()
                play_sound('tarot1')
                card.T.r = -0.2
                card:juice_up(0.3, 0.4)
                card.states.drag.is = true
                card.children.center.pinch.x = true
                -- This part destroys the card.
                G.E_MANAGER:add_event(Event({
                  trigger = 'after',
                  delay = 0.3,
                  blockable = false,
                  func = function()
                    G.jokers:remove_card(card)
                    card:remove()
                    card = nil
                    return true;
                  end
                }))
                return true
              end
            }))
            -- Sets the pool flag to true, meaning Gros Michel 2 doesn't spawn, and Cavendish 2 does.
            G.GAME.pool_flags.ricksCrayon_extinct = true
            return {
              message = 'SIGH!'
            }
          else
            return {
              message = 'Safe!'
            }
          end
        end
      end
}

SMODS.Joker{
    key = 'ricksCrayonStash',
    loc_txt = {
        name = 'Rick\'s Crayon Stash',
        text = {
        "{X:mult,C:white} X#1# {} Mult",
        "{C:green}#2# in #3#{} chance this",
        "card is destroyed",
        "at end of round"
        }
    },
    -- This also searches G.GAME.pool_flags to see if Gros Michel went extinct. If so, enables the ability to show up in shop.
    yes_pool_flag = 'ricksCrayon_extinct',
    config = { extra = { Xmult = 5, odds = 1000 } },
    rarity = 1,
    atlas = 'ricksCrayonStash',
    pos = { x = 0, y = 0 },
    cost = 4,
    unlocked = true,
    discovered = true,
    eternal_compat = false,
    loc_vars = function(self, info_queue, card)
        return { vars = { card.ability.extra.Xmult, (G.GAME.probabilities.normal or 1), card.ability.extra.odds } }
    end,
    calculate = function(self, card, context)
        if context.joker_main then
        return {
            message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } },
            Xmult_mod = card.ability.extra.Xmult
        }
        end
        if context.end_of_round and context.game_over == false and not context.repetition and not context.blueprint then
            if pseudorandom('cavendish2') < G.GAME.probabilities.normal / card.ability.extra.odds then
                G.E_MANAGER:add_event(Event({
          func = function()
            play_sound('tarot1')
            card.T.r = -0.2
            card:juice_up(0.3, 0.4)
            card.states.drag.is = true
            card.children.center.pinch.x = true
            G.E_MANAGER:add_event(Event({
              trigger = 'after',
              delay = 0.3,
              blockable = false,
              func = function()
                G.jokers:remove_card(card)
                card:remove()
                card = nil
                return true;
              end
            }))
            return true
          end
        }))
        return {
          message = 'SIGH!'
        }
      else
        return {
          message = 'Safe!'
        }
      end
    end
  end
}

SMODS.Joker{
    key = 'hotTake', -- joker key
    loc_txt = { -- local text
        name = 'Jamie\'s Hot Take',
        text = {
            '{C:green}#1# in #2#{} chance',
            'to downgrade',
            'level of played',
            '{C:attention}poker hand{}',
            '{C:green}#1# in #3#{} chance',
            'this card gains {X:mult,C:white} X#5# {} Mult',
            '{C:inactive}(Currently {X:mult,C:white} X#4# {C:inactive} Mult)'
        }
    },
    config = { extra = { odds = 5, odds2 = 2, Xmult = 1, Xmult_gain = 0.5, focus = card } },
    rarity = 1,
    atlas = 'hotTake',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 8,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { (G.GAME.probabilities.normal or 1), card.ability.extra.odds, card.ability.extra.odds2, card.ability.extra.Xmult, card.ability.extra.Xmult_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                Xmult_mod = card.ability.extra.Xmult,
                message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } }
            }
        end
        if context.before and not context.blueprint then
            if pseudorandom('hotTake') < G.GAME.probabilities.normal / card.ability.extra.odds and G.GAME.hands[context.scoring_name].level > 1 then
                return {
                    level_up = -1,
                    message = 'HOT TAKE!',
                    colour = G.C.MULT,
                    card = card
                }
            end
            if pseudorandom('hotTake2') < G.GAME.probabilities.normal / card.ability.extra.odds2 then
                card.ability.extra.Xmult = card.ability.extra.Xmult + card.ability.extra.Xmult_gain
                return {
                    message = 'GOOD TAKE!',
                    colour = G.C.MULT,
                    card = card
                }
            end
        end
    end
}

SMODS.Joker{
    key = 'fox', -- joker key
    loc_txt = { -- local text
        name = 'Hade',
        text = {
            '{C:mult}+#1#{} Mult for',
            'each remaining {C:attention}discard{}'
        }
    },
    config = { extra = { mult = 10 } },
    rarity = 1,
    atlas = 'fox',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 5,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.mult } }
    end,
    calculate = function (self, card, context)
        if context.joker_main and G.GAME.current_round.discards_left > 0 then
            return {
                mult_mod = card.ability.extra.mult * G.GAME.current_round.discards_left,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.mult * G.GAME.current_round.discards_left } },
                card = card,
                sound = 'mldg_hiMark'
            }
        end
    end
}

SMODS.Joker{
    key = 'nolem', -- joker key
    loc_txt = { -- local text
        name = 'Nolem',
        text = {
            '{C:mult}+#1#{} Mult',
            'if played hand has',
            'exactly {C:attention}2{} cards'
        }
    },
    config = { extra = {mult = 20} },
    rarity = 1,
    atlas = 'nolem',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 5,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.mult } }
    end,
    calculate = function (self, card, context)
        if context.joker_main and #context.full_hand == 2 then
            return {
                mult_mod = card.ability.extra.mult,
                message = localize { type = 'variable', key = 'a_mult', vars = { card.ability.extra.mult } }
            }
        end
    end
}

SMODS.Joker{
    key = 'fishbreakfast', -- joker key
    loc_txt = { -- local text
        name = 'Fish Breakfast',
        text = {
            '{C:chips}+#1#{} Chips {C:attention}-#2#{} hand size each round'
        }
    },
    config = { extra = { chips = 450, h_size = 2 } },
    rarity = 2,
    atlas = 'fishbreakfast',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 7,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.chips, card.ability.extra.h_size } }
    end,
    calculate = function (self, card, context)
        if context.setting_blind then
            G.hand:change_size(-card.ability.extra.h_size)
        end
        if context.joker_main then
            return {
                chips = card.ability.extra.chips
            }
        end
        if context.end_of_round and context.game_over == false and not context.repetition and not context.blueprint then
            G.hand:change_size(card.ability.extra.h_size)
        end
    end
}

SMODS.Joker{
    key = 'hypeTrain', -- joker key
    loc_txt = { -- local text
        name = 'Hype Train',
        text = {
            '{C:chips}+#2#{} Chips each round',
            '{C:inactive}(Currently {C:chips}+#1#{C:inactive} Chips)'
        }
    },
    config = { extra = { chips = 0, chips_gain = 50 } },
    rarity = 1,
    atlas = 'hypeTrain',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 8,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.chips, card.ability.extra.chips_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                chips = card.ability.extra.chips
            }
        end
        if context.end_of_round and context.game_over == false and not context.repetition and not context.blueprint then
            card.ability.extra.chips = card.ability.extra.chips + card.ability.extra.chips_gain
            return {
                message = 'CHOO CHOO!',
                colour = G.C.CHIPS,
                card = card,
                sound = 'mldg_choo-choo'
            }
        end
    end
}

SMODS.Joker{
    key = 'left_arm', -- joker key
    loc_txt = { -- local text
        name = 'Forbidden Dennis\' Left Arm',
        text = {
            '{X:mult,C:white} X#1# {} Mult for each',
            'scored {C:attention}Moldge{} card'
        }
    },
    config = { extra = { Xmult = 2 } },
    rarity = 3,
    atlas = 'left_arm',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult } }
    end,
    calculate = function (self, card, context)
        if context.individual and context.other_card.ability.name == 'm_mldg_moldge' and context.cardarea == G.play then
            return {
                Xmult_mod = card.ability.extra.Xmult,
                message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } },
                card = card
            }
        end
    end
}

SMODS.Joker{
    key = 'dennis_body', -- joker key
    loc_txt = { -- local text
        name = 'Forbidden Dennis\' Body',
        text = {
            '{C:chips}+#1#{} Chips for each',
            'scored {C:attention}Moldge{} card'
        }
    },
    config = { extra = { chips = 75 } },
    rarity = 3,
    atlas = 'dennis_body',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.chips } }
    end,
    calculate = function (self, card, context)
        if context.individual and context.other_card.ability.name == 'm_mldg_moldge' and context.cardarea == G.play then
            return {
                chips = card.ability.extra.chips,
                card = context.other_card
            }
        end
    end
}

SMODS.Joker{
    key = 'right_arm', -- joker key
    loc_txt = { -- local text
        name = 'Forbidden Dennis\' Right Arm',
        text = {
            '{X:mult,C:white} X#1# {} Mult for each',
            '{C:attention}Moldge{} card held in hand'
        }
    },
    config = { extra = { Xmult = 1.5 } },
    rarity = 3,
    atlas = 'right_arm',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult } }
    end,
    calculate = function (self, card, context)
        if context.individual and context.other_card.ability.name == 'm_mldg_moldge' and context.cardarea == G.hand and not context.debuffed_hand then
            return {
                Xmult_mod = card.ability.extra.Xmult,
                message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } },
                card = context.other_card
            }
        end
    end
}

SMODS.Joker{
    key = 'left_leg', -- joker key
    loc_txt = { -- local text
        name = 'Forbidden Dennis\' Left Leg',
        text = {
            'Retrigger all played',
            '{C:attention}Moldge{} cards'
        }
    },
    config = { extra = { repetitions = 1 } },
    rarity = 3,
    atlas = 'left_leg',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    calculate = function (self, card, context)
        if context.cardarea == G.play and context.repetition and not context.repetition_only and context.other_card.ability.name == 'm_mldg_moldge' then
            return {
                message = 'RAHHH!',
                repetitions = card.ability.extra.repetitions,
                card = context.other_card
            }
        end
    end
}

SMODS.Joker{
    key = 'right_leg', -- joker key
    loc_txt = { -- local text
        name = 'Forbidden Dennis\' Right Leg',
        text = {
            'Gains {X:mult,C:white} X#2# {} Mult',
            'if played hand contains,',
            'only {C:attention}Moldge{} cards',
            '{C:inactive}(Currently {X:mult,C:white} X#1# {C:inactive} Mult)'
        }
    },
    config = { extra = { Xmult = 1, Xmult_gain = 0.5} },
    rarity = 3,
    atlas = 'right_leg',
    unlocked = true,
    discovered = true,
    blueprint_compat = true,
    allow_duplicates = false,
    pos = { x = 0, y = 0 },
    cost = 10,
    isActive = true,
    loc_vars = function (self, info_queue, card)
        return { vars = { card.ability.extra.Xmult, card.ability.extra.Xmult_gain } }
    end,
    calculate = function (self, card, context)
        if context.joker_main then
            return {
                Xmult_mod = card.ability.extra.Xmult,
                message = localize { type = 'variable', key = 'a_xmult', vars = { card.ability.extra.Xmult } }
            }
        end

        if context.before and not context.blueprint then
            local moldge_count = 0
            for i = 1, #context.scoring_hand do
                if context.scoring_hand[i].ability.name == 'm_mldg_moldge' then moldge_count = moldge_count + 1 end
            end

            if moldge_count == #context.scoring_hand then
                card.ability.extra.Xmult = card.ability.extra.Xmult + card.ability.extra.Xmult_gain
                return {
                    message = 'FLUSH!',
                    colour = G.C.MULT,
                    card = card
                }
            end
        end
    end
}

SMODS.Enhancement{
    key = 'moldge', -- enhancement key
    loc_txt = { -- local text
        name = 'Moldge Card',
        text = {
            "It's just kind of moldy"
        }
    },
    config = { money = 1 },
    atlas = 'Enhancers',
    pos = { x = 0, y = 0 },
    weight = 5,
    loc_vars = function(self, info_queue)
        return { vars = { self.config.money } }
    end
}

----------------------------------------------
------------MOD CODE END----------------------
